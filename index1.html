<!DOCTYPE html>
<html b:version='2' xmlns='http://www.w3.org/1999/xhtml' lang='ar' dir='rtl'>
<head>
  <b:include data='blog' name='all-head-content'/>
  
  <meta name="description" content="حكايتنا - أفضل موقع لمشاهدة المسلسلات التركية مترجمة ومدبلجة بجودة عالية. تابع أحدث الحلقات من مسلسلاتك المفضلة مجاناً وبدون إعلانات مزعجة. مسلسلات دراما، أكشن، رومانسية، وكوميديا تركية."/>
  <meta name="keywords" content="مسلسلات تركية, حكايتنا, مسلسلات مترجمة, مسلسلات مدبلجة, مشاهدة مسلسلات تركية, أحدث المسلسلات التركية, مسلسلات 2025, دراما تركية, أكشن تركي, مسلسلات رومانسية تركية, مسلسلات كوميدية تركية, مسلسلات تركية اون لاين, موقع مسلسلات تركية"/>
  <meta name="author" content="حكايتنا"/>
  <meta name="robots" content="index, follow"/>
  <link rel="canonical" expr:href='data:blog.url'/>

  <meta property="og:title" content="حكايتنا - مسلسلات تركية مترجمة ومدبلجة بجودة عالية"/>
  <meta property="og:description" content="أفضل موقع لمشاهدة المسلسلات التركية مترجمة ومدبلجة بجودة عالية. تابع أحدث الحلقات من مسلسلاتك المفضلة مجاناً وبدون إعلانات مزعجة."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" expr:content='data:blog.url'/>
  <meta property="og:image" content="https://l.top4top.io/p_3472qtqft0.png"/> <meta property="og:site_name" content="حكايتنا"/>
  <meta property="og:locale" content="ar_AR"/>

  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@yourtwitterhandle"/> <meta name="twitter:creator" content="@yourtwitterhandle"/>
  <meta name="twitter:title" content="حكايتنا - مسلسلات تركية مترجمة ومدبلجة بجودة عالية"/>
  <meta name="twitter:description" content="أفضل موقع لمشاهدة المسلسلات التركية مترجمة ومدبلجة بجودة عالية. تابع أحدث الحلقات من مسلسلاتك المفضلة مجاناً وبدون إعلانات مزعجة."/>
  <meta name="twitter:image" content="https://l.top4top.io/p_3472qtqft0.png"/>

  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "حكايتنا - مسلسلات تركية",
    "url": "https://your-blog-address.blogspot.com/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://your-blog-address.blogspot.com/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "description": "أفضل موقع لمشاهدة المسلسلات التركية مترجمة ومدبلجة بجودة عالية. تابع أحدث الحلقات من مسلسلاتك المفضلة مجاناً وبدون إعلانات مزعجة.",
    "publisher": {
      "@type": "Organization",
      "name": "حكايتنا"
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "الرئيسية",
        "item": "https://your-blog-address.blogspot.com/"
      }
      ]
  }
  </script>

  <b:skin><![CDATA[
    /* ******** الخطوط: Google Fonts - Cairo و Poppins ******** */
    /* تحسين تحميل الخطوط: إضافة display=swap لتحسين سرعة العرض (CLS) */
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@400;600;700&display=swap');

    :root {
        /* Default Theme: Fire Theme */
        --primary-color: #ff3b3b; /* أحمر ناري */
        --secondary-color: #ff8c00; /* برتقالي حيوي */
        --dark-bg-main: #0a0a0a; /* أسود عميق جداً */
        --dark-bg-secondary: #1a1a1a;
        --card-bg: #1f1f1f;
        --section-bg: #2b2b2b;
        --text-light: #f0f0f0;
        --text-muted: #aaaaaa;
        --border-color: #444444;
        --shadow-dark: rgba(0,0,0,0.9);
        --shadow-light: rgba(0,0,0,0.6);
        --glow-primary: rgba(255, 59, 59, 0.7); /* توهج أحمر */
        --glow-secondary: rgba(255, 140, 0, 0.7); /* توهج برتقالي */
        --header-gradient: linear-gradient(90deg, #8b0000, var(--primary-color));
        --body-gradient: linear-gradient(145deg, var(--dark-bg-main), #100000);
        --sidebar-gradient: linear-gradient(180deg, #1f0000, #000);
        --card-gradient: linear-gradient(145deg, #2a0000, #1a1a1a);
        --episodes-gradient: linear-gradient(180deg, #1a0000, #000);
        --episode-link-bg: #3a1111;
        --episode-link-hover-gradient: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        --new-episode-indicator-bg: linear-gradient(45deg, #00FF00, #00AA00);
        --new-episode-glow: rgba(0, 255, 0, 0.7);
    }

    /* Blue Theme */
    body.blue-theme {
        --primary-color: #007bff; /* أزرق أساسي */
        --secondary-color: #66afe9; /* أزرق فاتح */
        --dark-bg-main: #101520; /* أزرق داكن جدا */
        --dark-bg-secondary: #1a202c;
        --card-bg: #212d3b;
        --section-bg: #2c3e50;
        --text-light: #e0f2f7;
        --text-muted: #aab8c2;
        --border-color: #4a6572;
        --shadow-dark: rgba(0,0,0,0.8);
        --shadow-light: rgba(0,0,0,0.5);
        --glow-primary: rgba(0, 123, 255, 0.6);
        --glow-secondary: rgba(102, 175, 233, 0.6);
        --header-gradient: linear-gradient(90deg, #0056b3, var(--primary-color));
        --body-gradient: linear-gradient(145deg, var(--dark-bg-main), #080c10);
        --sidebar-gradient: linear-gradient(180deg, #152232, #0a1118);
        --card-gradient: linear-gradient(145deg, #1e283a, #151e2a);
        --episodes-gradient: linear-gradient(180deg, #1a2736, #0f1824);
        --episode-link-bg: #2d4154;
        --episode-link-hover-gradient: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        --new-episode-indicator-bg: linear-gradient(45deg, #28a745, #218838);
        --new-episode-glow: rgba(40, 167, 69, 0.7);
    }

    /* Green Dark Theme */
    body.green-theme {
        --primary-color: #28a745; /* أخضر زيتي */
        --secondary-color: #ffc107; /* ذهبي */
        --dark-bg-main: #1a1a1a;
        --dark-bg-secondary: #222222;
        --card-bg: #2c2c2c;
        --section-bg: #383838;
        --text-light: #e6e6e6;
        --text-muted: #b0b0b0;
        --border-color: #555555;
        --shadow-dark: rgba(0,0,0,0.85);
        --shadow-light: rgba(0,0,0,0.6);
        --glow-primary: rgba(40, 167, 69, 0.6);
        --glow-secondary: rgba(255, 193, 7, 0.6);
        --header-gradient: linear-gradient(90deg, #1f7b3a, var(--primary-color));
        --body-gradient: linear-gradient(145deg, var(--dark-bg-main), #151515);
        --sidebar-gradient: linear-gradient(180deg, #2a2a2a, #1a1a1a);
        --card-gradient: linear-gradient(145deg, #303030, #252525);
        --episodes-gradient: linear-gradient(180deg, #3a3a3a, #2a2a2a);
        --episode-link-bg: #4a4a4a;
        --episode-link-hover-gradient: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        --new-episode-indicator-bg: linear-gradient(45deg, #17a2b8, #138496); /* أزرق سيان مميز */
        --new-episode-glow: rgba(23, 162, 184, 0.7);
    }

    body {
      background: var(--body-gradient);
      font-family: 'Cairo', sans-serif;
      color: var(--text-light);
      margin: 0;
      overflow-x: hidden;
      direction: rtl;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      transition: background 0.6s ease; /* إضافة انتقال للخلفية */
    }

    /* ******** Loader CSS - أكثر إثارة ******** */
    #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #000, var(--dark-bg-main)); /* خلفية اللودر بتدرج ناري */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
        transition: opacity 0.6s ease, visibility 0.6s ease;
    }
    .spinner {
        border: 5px solid rgba(255, 255, 255, 0.2);
        border-top: 5px solid var(--primary-color); /* لون أحمر ناري */
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite; /* حركة سبينر أكثر حيوية */
        margin-bottom: 25px;
        box-shadow: 0 0 20px var(--glow-primary); /* توهج حول السبينر */
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    #loader p {
        color: var(--text-light);
        font-size: 20px;
        font-family: 'Poppins', sans-serif;
        text-shadow: 0 0 10px var(--glow-primary); /* توهج للنص */
    }

    /* ******** Header and Navigation ******** */
    .header {
      background: var(--header-gradient);
      padding: 20px 25px;
      text-align: center;
      font-size: 32px;
      font-weight: 700;
      position: relative;
      z-index: 1002;
      box-shadow: 0 6px 20px var(--shadow-dark); /* ظل أقوى */
      letter-spacing: 2px;
      color: #fff;
      text-shadow: 0 0 15px rgba(255,255,255,0.8); /* توهج أبيض للنص */
      border-bottom: 3px solid var(--secondary-color); /* خط برتقالي مميز */
      transition: background 0.6s ease, border-color 0.6s ease;
    }
    .hamburger {
      position: fixed;
      top: 25px;
      right: 25px;
      width: 38px;
      height: 32px;
      cursor: pointer;
      z-index: 1100;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); /* تدرج ناري لزر الهامبرجر */
      padding: 8px;
      border-radius: 10px;
      box-shadow: 0 0 18px var(--glow-primary); /* توهج ناري */
    }
    .hamburger:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px var(--glow-secondary);
    }
    .hamburger span {
      display: block;
      height: 4px;
      background: #fff;
      border-radius: 3px;
      transition: 0.4s;
      box-shadow: 0 0 5px rgba(255,255,255,0.5); /* ظل خفيف على الشرائط */
    }
    .hamburger.open span:nth-child(1) {
      transform: rotate(45deg) translate(9px, 9px);
    }
    .hamburger.open span:nth-child(2) {
      opacity: 0;
    }
    .hamburger.open span:nth-child(3) {
      transform: rotate(-45deg) translate(9px, -9px);
    }

    /* Sidebar - القائمة الجانبية النارية */
    .sidebar {
      position: fixed;
      top: 0;
      right: 0;
      width: 300px; /* عرض مناسب */
      height: 100vh;
      background: var(--sidebar-gradient);
      box-shadow: -10px 0 40px var(--shadow-dark); /* ظل أقوى وأكثر انتشاراً */
      padding: 90px 30px 30px;
      transform: translateX(100%);
      transition: transform 0.7s cubic-bezier(0.86, 0, 0.07, 1), background 0.6s ease, border-color 0.6s ease; /* إضافة انتقال للخلفية */
      z-index: 1050;
      overflow-y: auto;
      will-change: transform;
      border-left: 5px solid var(--primary-color); /* خط أحمر سميك على الجانب */
      box-sizing: border-box;
      display: flex; /* لترتيب المحتوى داخله */
      flex-direction: column; /* لترتيب المحتوى عمودياً */
    }
    .sidebar.open {
      transform: translateX(0);
    }
    .sidebar .close-btn {
      position: absolute;
      top: 30px;
      left: 30px;
      font-size: 45px; /* حجم كبير للزر */
      color: var(--secondary-color); /* لون برتقالي لافت */
      cursor: pointer;
      transition: transform 0.4s ease, color 0.4s ease, background 0.4s ease;
      background: rgba(255, 255, 255, 0.15); /* خلفية شفافة مميزة */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 15px var(--glow-secondary); /* توهج برتقالي */
      text-shadow: 0 0 8px #fff;
    }
    .sidebar .close-btn:hover {
      transform: rotate(180deg) scale(1.15); /* دوران كامل وتكبير */
      color: #fff;
      background: var(--primary-color);
      box-shadow: 0 0 25px var(--glow-primary);
    }
    .sidebar-logo {
      width: 100%;
      max-width: 250px; /* حجم أكبر للوجو */
      display: block;
      margin: 0 auto 50px; /* مسافة أكبر بعد اللوجو */
      filter: drop-shadow(0 0 20px var(--glow-primary)); /* توهج أحمر قوي */
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* حركة نطاطية خفيفة */
    }
    .sidebar-logo:hover {
        transform: scale(1.08);
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 50px 0 30px 0;
      flex-grow: 1; /* لتأخذ المساحة المتاحة وتدفع حقوق الموقع للأسفل */
    }
    .sidebar ul li {
      margin-bottom: 20px;
    }
    .sidebar ul li a {
      color: var(--text-light);
      text-decoration: none;
      font-size: 22px; /* حجم خط أكبر للروابط */
      display: flex;
      align-items: center;
      padding: 15px 25px;
      border-radius: 12px; /* حواف أكثر دائرية */
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* حركة انتقالية ناعمة */
      font-weight: 700; /* خط أثقل */
      background: rgba(255,255,255,0.08); /* خلفية شفافة للروابط */
      box-shadow: 0 5px 15px var(--shadow-light); /* ظل عميق */
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar ul li a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -120%; /* تأثير أطول */
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--primary-color), transparent); /* تدرج أحمر متوهج */
      transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
      z-index: -1;
      opacity: 0;
      transform: skewX(-20deg); /* تأثير ميلان أثناء الحركة */
    }
    .sidebar ul li a:hover::before {
      left: 0;
      opacity: 1;
    }
    .sidebar ul li a:hover {
      color: #fff;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); /* تدرج ناري عند التمرير */
      transform: translateX(-10px) scale(1.03); /* حركة أكبر وتكبير بسيط */
      box-shadow: 0 10px 25px var(--glow-primary), 0 0 40px var(--glow-secondary); /* توهج مزدوج */
      border-color: var(--secondary-color);
    }

    /* أيقونات جانبية محسّنة */
    .sidebar ul li a.telegram::before,
    .sidebar ul li a.contact::before,
    .sidebar ul li a.latest-series::before,
    .sidebar ul li a.most-viewed::before,
    .sidebar ul li a.top-rated::before,
    .sidebar ul li a.theme-selector::before, /* أيقونة لمحدد الثيمات */
    .sidebar ul li a.remove-ads::before { /* أيقونة لإزالة الإعلانات */
      content: '';
      display: inline-block;
      width: 28px; /* حجم الأيقونات */
      height: 28px;
      margin-right: 20px;
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      transition: transform 0.3s ease, filter 0.3s ease;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.7)); /* توهج أبيض للأيقونات */
    }
    .sidebar ul li a.telegram::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"%3E%3Cline x1="22" y1="2" x2="11" y2="13"%3E%3C/line%3E%3Cpolygon points="22 2 15 22 11 13 2 9 22 2"%3E%3C/polygon%3E%3C/svg%3E');
        transform: rotate(45deg);
    }
    .sidebar ul li a.contact::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"%3E%3Cpath d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"%3E%3C/path%3E%3Cpolyline points="22,6 12,13 2,6"%3E%3C/polyline%3E%3C%2Fsvg%3E');
    }
    /* أيقونة لـ "آخر المسلسلات" */
    .sidebar ul li a.latest-series::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"%3E%3Crect x="3" y="4" width="18" height="18" rx="2" ry="2"%3E%3C/rect%3E%3Cline x1="16" y1="2" x2="16" y2="6"%3E%3C/line%3E%3Cline x1="8" y1="2" x2="8" y2="6"%3E%3C/line%3E%3Cline x1="3" y1="10" x2="21" y2="10"%3E%3C/line%3E%3C/svg%3E');
    }
    /* أيقونة لـ "المسلسلات الأكثر مشاهدة" */
    .sidebar ul li a.most-viewed::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"%3E%3Cpath d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"%3E%3C/path%3E%3Ccircle cx="12" cy="12" r="3"%3E%3C/circle%3E%3C/svg%3E');
    }
    /* أيقونة لـ "المسلسلات الأعلى تقييمًا" */
    .sidebar ul li a.top-rated::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"%3E%3Cpolygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"%3E%3C/polygon%3E%3C/svg%3E');
    }
    /* أيقونة لمحدد الثيمات */
    .sidebar ul li a.theme-selector::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"%3E%3Ccircle cx="12" cy="12" r="5"%3E%3C/circle%3E%3Cline x1="12" y1="1" x2="12" y2="3"%3E%3C/line%3E%3Cline x1="12" y1="21" x2="12" y2="23"%3E%3C/line%3E%3Cline x1="4.22" y1="4.22" x2="5.64" y2="5.64"%3E%3C/line%3E%3Cline x1="18.36" y1="18.36" x2="19.78" y2="19.78"%3E%3C/line%3E%3Cline x1="1" y1="12" x2="3" y2="12"%3E%3C/line%3E%3Cline x1="21" y1="12" x2="23" y2="12"%3E%3C/line%3E%3Cline x1="4.22" y1="19.78" x2="5.64" y2="18.36"%3E%3C/line%3E%3Cline x1="18.36" y1="5.64" x2="19.78" y2="4.22"%3E%3C/line%3E%3C/svg%3E');
    }
    /* أيقونة لإزالة الإعلانات (نظام النقاط) */
    .sidebar ul li a.remove-ads::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23f0f0f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye-off"%3E%3Cpath d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.06 18.06 0 0 1 2.76-3.95M2.34 2.34L21.66 21.66"%3E%3C/path%3E%3Cpath d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.06 18.06 0 0 1 2.76-3.95M2.34 2.34L21.66 21.66M1 1l22 22"%3E%3C/path%3E%3Ccircle cx="12" cy="12" r="3"%3E%3C/circle%3E%3C/svg%3E');
    }


    /* Hover states for icons */
    .sidebar ul li a:hover.telegram::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"%3E%3Cline x1="22" y1="2" x2="11" y2="13"%3E%3C/line%3E%3Cpolygon points="22 2 15 22 11 13 2 9 22 2"%3E%3C/polygon%3E%3C/svg%3E');
        transform: rotate(45deg) scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.contact::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"%3E%3Cpath d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"%3E%3C/path%3E%3Cpolyline points="22,6 12,13 2,6"%3E%3C/polyline%3E%3C%2Fsvg%3E');
        transform: scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.latest-series::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"%3E%3Crect x="3" y="4" width="18" height="18" rx="2" ry="2"%3E%3C/rect%3E%3Cline x1="16" y1="2" x2="16" y2="6"%3E%3C/line%3E%3Cline x1="8" y1="2" x2="8" y2="6"%3E%3C/line%3E%3Cline x1="3" y1="10" x2="21" y2="10"%3E%3C/line%3E%3C/svg%3E');
        transform: scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.most-viewed::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"%3E%3Cpath d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"%3E%3C/path%3E%3Ccircle cx="12" cy="12" r="3"%3E%3C/circle%3E%3C/svg%3E');
        transform: scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.top-rated::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"%3E%3Cpolygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"%3E%3C/polygon%3E%3C/svg%3E');
        transform: scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.theme-selector::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"%3E%3Ccircle cx="12" cy="12" r="5"%3E%3C/circle%3E%3Cline x1="12" y1="1" x2="12" y2="3"%3E%3C/line%3E%3Cline x1="12" y1="21" x2="12" y2="23"%3E%3C/line%3E%3Cline x1="4.22" y1="4.22" x2="5.64" y2="5.64"%3E%3C/line%3E%3Cline x1="18.36" y1="18.36" x2="19.78" y2="19.78"%3E%3C/line%3E%3Cline x1="1" y1="12" x2="3" y2="12"%3E%3C/line%3E%3Cline x1="21" y1="12" x2="23" y2="12"%3E%3C/line%3E%3Cline x1="4.22" y1="19.78" x2="5.64" y2="18.36"%3E%3C/line%3E%3Cline x1="18.36" y1="5.64" x2="19.78" y2="4.22"%3E%3C/line%3E%3C/svg%3E');
        transform: scale(1.15) rotate(90deg); /* دوران مميز */
        filter: drop-shadow(0 0 10px #fff);
    }
    .sidebar ul li a:hover.remove-ads::before {
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"%3E%3Cpath d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"%3E%3C/path%3E%3Ccircle cx="12" cy="12" r="3"%3E%3C/circle%3E%3C/svg%3E'); /* أيقونة عين مفتوحة عند التمرير */
        transform: scale(1.15);
        filter: drop-shadow(0 0 10px #fff);
    }


    /* Theme Picker Container (Hidden by default) */
    .theme-picker {
        display: none; /* مخفي افتراضياً */
        flex-direction: column;
        padding: 15px;
        background: var(--dark-bg-secondary);
        border-radius: 12px;
        margin-top: 15px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        border: 1px solid var(--border-color);
    }
    .theme-picker.active {
        display: flex; /* يظهر عند التفعيل */
    }
    .theme-picker h4 {
        color: var(--text-light);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        text-align: center;
        text-shadow: 0 0 5px rgba(255,255,255,0.3);
    }
    .theme-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }
    .theme-option {
        width: 80px; /* حجم أصغر لمربعات الثيمات */
        height: 80px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-size: 12px;
        color: var(--text-light);
        border: 2px solid transparent;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px var(--shadow-dark);
        position: relative;
        overflow: hidden;
    }
    .theme-option:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 15px var(--glow-primary);
    }
    .theme-option.active-theme {
        border-color: var(--secondary-color); /* إطار حول الثيم النشط */
        box-shadow: 0 0 15px var(--glow-secondary);
        transform: scale(1.08);
    }
    .theme-option .color-box {
        width: 100%;
        height: 60%; /* جزء أكبر للون */
        display: flex;
        border-radius: 6px 6px 0 0;
    }
    .theme-option .color-box span {
        flex: 1;
        height: 100%;
    }
    .theme-option .theme-name {
        font-size: 13px;
        font-weight: bold;
        margin-top: 5px;
        color: var(--text-light);
        text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    /* Specific theme color indicators */
    .theme-fire .color-box {
        background: linear-gradient(45deg, #ff3b3b, #ff8c00);
    }
    .theme-blue .color-box {
        background: linear-gradient(45deg, #007bff, #66afe9);
    }
    .theme-green .color-box {
        background: linear-gradient(45deg, #28a745, #ffc107);
    }

    /* Styles for Points System in Sidebar */
    .points-system-container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 5px 15px var(--shadow-dark);
        border: 1px solid var(--border-color);
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .points-system-container h4 {
        color: var(--primary-color);
        margin: 0 0 10px 0;
        font-size: 20px;
        text-shadow: 0 0 10px var(--glow-primary);
    }

    .points-info {
        font-size: 16px;
        color: var(--text-light);
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
    }

    .points-info span {
        font-weight: bold;
        color: var(--secondary-color);
        font-size: 18px;
        text-shadow: 0 0 5px var(--glow-secondary);
    }

    .share-link-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .share-link-input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: var(--dark-bg-secondary);
        color: var(--text-light);
        font-size: 14px;
        text-align: center;
        box-sizing: border-box;
        cursor: text;
    }

    .copy-link-btn {
        background: var(--primary-color);
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .copy-link-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px var(--glow-primary);
    }

    .hide-ads-btn {
        background: #4CAF50; /* أخضر */
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        margin-top: 10px;
    }

    .hide-ads-btn:disabled {
        background: #666;
        cursor: not-allowed;
        opacity: 0.7;
        box-shadow: none;
        transform: none;
    }

    .hide-ads-btn:hover:not(:disabled) {
        background: #45a049;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.7);
    }

    /* Style for ads-box when hidden */
    .ads-box.hidden {
        display: none !important;
    }


    /* Copyright Footer in Sidebar */
    .sidebar-footer {
        margin-top: auto; /* يدفع الحقوق للأسفل */
        padding-top: 20px;
        border-top: 1px solid rgba(255,255,255,0.1);
        text-align: center;
        font-size: 14px;
        color: var(--text-muted);
        text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    .sidebar-footer a {
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s ease;
    }
    .sidebar-footer a:hover {
        color: var(--primary-color);
        text-decoration: underline;
    }

    /* Overlay - طبقة التعتيم */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85); /* تعتيم أقوى وأكثر دراماتيكية */
        z-index: 1040;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.6s ease-out, visibility 0.6s ease-out;
        cursor: pointer;
    }
    .overlay.active {
        opacity: 1;
        visibility: visible;
    }

    /* Content Wrapper - المحتوى الرئيسي */
    .content-wrapper {
        transition: filter 0.6s ease;
    }
    .content-wrapper.blurred {
        filter: blur(8px) brightness(0.7); /* تأثير بلور وغمقان أقوى */
        pointer-events: none;
    }

    /* ******** Search Container ******** */
    .search-container {
      max-width: 900px;
      margin: 40px auto 0;
      padding: 0 20px;
      position: relative;
      z-index: 10;
    }
    .search-box {
      width: 100%;
      padding: 18px 25px;
      font-size: 20px;
      border-radius: 40px;
      border: 3px solid var(--primary-color); /* إطار أحمر سميك */
      background: #111; /* خلفية أغمق لمدخل البحث */
      color: #fff;
      box-shadow: 0 0 20px var(--glow-primary); /* توهج أحمر */
      outline: none;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .search-box::placeholder {
      color: var(--text-muted);
      opacity: 0.8;
    }
    .search-box:focus {
      box-shadow: 0 0 30px var(--glow-secondary), 0 0 15px var(--glow-primary); /* توهج مزدوج عند التركيز */
      border-color: var(--secondary-color);
      transform: scale(1.02);
      background: #080808;
    }

    /* ******** Series Container & Cards ******** */
    .series-container {
      max-width: 980px; /* عرض أكبر للكونتينر */
      margin: 50px auto 80px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); /* حجم أكبر للبطاقات */
      gap: 30px; /* مسافات أكبر بين البطاقات */
      padding: 0 25px;
      position: relative;
      z-index: 5;
    }
    .series-card {
      background: var(--card-gradient);
      border-radius: 20px; /* حواف أكثر دائرية */
      overflow: visible; /* تغيير إلى visible لضمان ظهور الـ category badge */
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.5s ease, background 0.6s ease; /* إضافة انتقال للخلفية */
      position: relative;
      z-index: 1;
      box-shadow: 0 8px 20px var(--shadow-dark); /* ظل عميق */
      opacity: 0;
      transform: translateY(30px);
      border: 2px solid rgba(255,255,255,0.05); /* إطار خفيف */
    }
    .series-card.visible {
        opacity: 1;
        transform: translateY(0);
    }
    .series-card:hover {
      transform: translateY(-12px) scale(1.05); /* حركة أكبر عند التمرير */
      box-shadow: 0 15px 40px var(--glow-primary), 0 0 25px var(--glow-secondary); /* توهج ناري مزدوج */
      z-index: 10;
      border-color: var(--primary-color);
    }
    .series-card img {
      width: 100%;
      height: 250px; /* ارتفاع أكبر للصورة */
      object-fit: cover;
      display: block;
      border-radius: 18px 18px 0 0;
      filter: brightness(0.95); /* جعل الصور أغمق قليلاً لتناسق الألوان */
      transition: filter 0.3s ease;
    }
    .series-card:hover img {
        filter: brightness(1.1); /* إضاءة الصورة عند التمرير */
    }
    .series-card-title {
      padding: 15px 12px;
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      color: var(--text-light);
      text-shadow: 0 0 8px rgba(255,255,255,0.7); /* توهج للنص */
    }

    /* New Episode Indicator */
    .new-episode-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--new-episode-indicator-bg); /* أخضر فاقع */
        color: white;
        padding: 5px 10px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: bold;
        animation: pulse 1.5s infinite alternate; /* تأثير نبض */
        box-shadow: 0 0 15px var(--new-episode-glow);
        z-index: 2; /* فوق الصورة */
        border: 1px solid #fff;
    }
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.05); opacity: 0.9; }
    }

    /* Category Badge - شارة التصنيف الجديدة */
    .category-badge {
        position: absolute;
        top: 25px; /* بعد قليل من الحافة العلوية */
        left: -10px; /* لإظهارها وكأنها خارج البطاقة قليلاً */
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); /* تدرج ناري */
        color: white;
        padding: 6px 15px;
        border-radius: 0 10px 10px 0; /* حواف دائرية من اليمين فقط */
        font-size: 14px;
        font-weight: bold;
        transform: rotate(-5deg); /* ميلان خفيف */
        transform-origin: top left;
        box-shadow: 5px 5px 15px rgba(0,0,0,0.5); /* ظل لتبرز */
        z-index: 3; /* فوق الصورة وإشعار الحلقة الجديدة */
        border-left: 3px solid #fff; /* خط أبيض على اليسار */
        text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    /* Ads Box Styling */
    .ads-box {
      margin: 20px auto;
      text-align: center;
      /* يمكنك إضافة المزيد من التنسيقات هنا لجعل الإعلانات تظهر بشكل أفضل */
      /* على سبيل المثال، إطار أو خلفية مميزة */
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 10px;
      background: var(--card-bg);
      box-shadow: 0 4px 15px var(--shadow-dark);
    }
    /* لضمان ظهور الإعلانات بشكل جيد على الشاشات الصغيرة */
    @media (max-width: 600px) {
      .ads-box {
        width: 100%; /* اجعل الإعلانات تأخذ العرض الكامل على الجوالات */
        box-sizing: border-box; /* لضمان عدم تجاوز العرض المحدد */
        padding: 5px;
      }
    }


    /* Views & Likes Section (unified) */
    .stats-section {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 15px;
      background: linear-gradient(90deg, #100000, #200000); /* تدرج خلفية للقسم */
      border-top: 2px solid var(--primary-color); /* خط أحمر فاصل */
      border-radius: 0 0 20px 20px;
      font-size: 15px;
      height: 70px; /* ارتفاع ثابت لضمان عدم اهتزاز البطاقات */
      transition: background 0.6s ease, border-color 0.6s ease;
    }
    body.blue-theme .stats-section {
        background: linear-gradient(90deg, #101825, #1a2430);
    }
    body.green-theme .stats-section {
        background: linear-gradient(90deg, #2a2a2a, #353535);
    }
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-muted);
      font-weight: 600;
      gap: 5px;
    }
    .stat-item .icon-and-count {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .stat-item svg {
        width: 22px; /* أيقونات أكبر */
        height: 22px;
        fill: var(--text-muted);
        transition: fill 0.3s ease, transform 0.3s ease;
        filter: drop-shadow(0 0 5px rgba(255,255,255,0.3));
    }
    .stat-item .count {
        font-size: 17px;
        color: var(--text-light);
        font-weight: 700;
        text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }
    .stat-item .label {
        font-size: 13px;
        color: var(--text-muted);
        text-align: center;
        margin-top: 3px;
    }

    /* Like Button specific styles - أكثر حيوية */
    .like-button {
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    .like-button:hover {
      transform: scale(1.2);
      filter: brightness(1.2);
    }
    /* حالة الإعجاب */
    .like-button.liked svg {
      fill: var(--primary-color); /* أحمر ناري عند الإعجاب */
      filter: drop-shadow(0 0 10px var(--glow-primary)); /* توهج أحمر قوي */
    }
    .like-button.liked .count {
      color: var(--primary-color);
      text-shadow: 0 0 10px var(--glow-primary);
    }
    .like-button.liked .label {
      color: var(--primary-color);
    }


    /* ******** Episodes Styling (Popup) ******** */
    .episodes {
      position: absolute;
      width: calc(100% + 20px);
      left: -10px;
      background: var(--episodes-gradient);
      padding: 20px;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 12px 35px var(--shadow-dark); /* ظل أعمق */
      z-index: 1000;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.5s ease, visibility 0.5s ease, top 0.5s ease, background 0.6s ease, border-color 0.6s ease;
      max-height: 450px; /* ارتفاع أكبر للحلقات */
      overflow-y: auto;
      border-top: 3px solid var(--secondary-color); /* خط برتقالي مميز */
    }
    .episodes.show {
      visibility: visible;
      opacity: 1;
    }
    /* Hide scrollbar for Chrome, Safari and Opera */
    .episodes::-webkit-scrollbar {
        width: 10px; /* عرض أكبر للسك્રોલ بار */
    }
    .episodes::-webkit-scrollbar-track {
        background: #333;
        border-radius: 10px;
    }
    .episodes::-webkit-scrollbar-thumb {
        background: var(--primary-color); /* أحمر ناري للسك્રોલ بار */
        border-radius: 10px;
        box-shadow: 0 0 8px var(--glow-primary);
    }
    .episodes::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-color);
        box-shadow: 0 0 10px var(--glow-secondary);
    }

    /* ****** تنسيق روابط الحلقات داخل .episodes ****** */
    .episodes a {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--text-light);
      background: var(--episode-link-bg); /* خلفية حمراء داكنة للحلقات */
      padding: 15px 20px;
      margin-bottom: 12px;
      border-radius: 10px;
      text-decoration: none;
      font-size: 17px;
      transition: all 0.3s ease, background 0.6s ease, border-color 0.6s ease;
      box-shadow: 0 4px 12px var(--shadow-light);
      position: relative;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .episodes a.new-episode-link { /* تنسيق خاص للحلقة الجديدة داخل القائمة المنبثقة */
        background: linear-gradient(90deg, #500000, #3a1111);
        border: 2px solid var(--primary-color);
        animation: newEpisodePulse 2s infinite ease-in-out;
    }
    body.blue-theme .episodes a.new-episode-link {
        background: linear-gradient(90deg, #0a1118, #1a2736);
        border: 2px solid var(--primary-color);
    }
    body.green-theme .episodes a.new-episode-link {
        background: linear-gradient(90deg, #2a2a2a, #3a3a3a);
        border: 2px solid var(--primary-color);
    }

    @keyframes newEpisodePulse {
        0% { border-color: var(--primary-color); box-shadow: 0 0 10px var(--glow-primary); }
        50% { border-color: var(--secondary-color); box-shadow: 0 0 20px var(--glow-secondary); }
        100% { border-color: var(--primary-color); box-shadow: 0 0 10px var(--glow-primary); }
    }

    .episodes a:last-child {
      margin-bottom: 0;
    }
    .episodes a:hover {
      background: var(--episode-link-hover-gradient);
      color: #fff;
      transform: translateX(-8px) scale(1.01);
      box-shadow: 0 6px 18px var(--glow-primary);
      border-color: var(--secondary-color);
    }
    /* أيقونة Play - تم ترميزها بالكامل لضمان التوافق مع XML */
    .episodes a::before {
      content: '';
      width: 28px; /* أيقونة أكبر */
      height: 28px;
      display: inline-block;
      margin-left: 15px;
      background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2224%22%20viewBox%3D%220%20-960%20960%20960%22%20width%3D%2224%22%20fill%3D%22%2523f0f0f0%22%3E%3Cpath%20d%3D%22M320-200v-560l440%20280-440%20280Zm80-280Zm0%20130%20200-130-200-130v260Z%22%2F%3E%3C%2Fsvg%3E');
      background-size: contain;
      background-repeat: no-repeat;
      vertical-align: middle;
      filter: drop_shadow(0 0 5px rgba(255,255,255,0.5));
    }
    .episodes a:hover::before {
        background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2224%22%20viewBox%3D%220%20-960%20960%20960%22%20width%3D%2224%22%20fill%3D%22%2523ffffff%22%3E%3Cpath%20d%3D%22M320-200v-560l440%20280-440%20280Zm80-280Zm0%20130%20200-130-200-130v260Z%22%2F%3E%3C%2Fsvg%3E');
        transform: scale(1.1);
        filter: drop_shadow(0 0 10px #fff);
    }
    /* تأثيرات ظهور الحلقات عند التمرير (JavaScript controlled) */
    .episode-link-initial {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }
    .episode-link-fade-in {
        opacity: 1;
        transform: translateY(0);
    }

    /* Video Player Styles */
    .video-player-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95); /* خلفية معتمة جداً */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000; /* ليكون فوق كل شيء */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0.4s ease;
    }
    .video-player-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    .video-player-container {
        position: relative;
        width: 90%;
        max-width: 960px; /* حجم أقصى للمشغل */
        aspect-ratio: 16 / 9; /* نسبة عرض إلى ارتفاع قياسية للفيديو */
        background: var(--dark-bg-secondary);
        border-radius: 15px;
        box-shadow: 0 0 40px rgba(0,0,0,0.8), 0 0 20px var(--glow-primary);
        transform: scale(0.8);
        opacity: 0;
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.4s ease;
        border: 2px solid var(--primary-color);
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .video-player-overlay.active .video-player-container {
        transform: scale(1);
        opacity: 1;
    }
    .video-player-iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 12px;
    }
    .video-player-close {
        position: absolute;
        top: -20px; /* فوق المشغل قليلاً */
        right: -20px; /* إلى اليمين قليلاً */
        background: var(--primary-color);
        color: #fff;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 30px;
        font-weight: bold;
        cursor: pointer;
        z-index: 2001;
        box-shadow: 0 0 15px var(--glow-primary), 0 0 8px rgba(255,255,255,0.7);
        transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
    }
    .video-player-close:hover {
        transform: scale(1.1) rotate(90deg);
        background: var(--secondary-color);
        box-shadow: 0 0 20px var(--glow-secondary), 0 0 10px #fff;
    }


    /* ******** Media Queries for Responsiveness ******** */
    @media (min-width: 768px) { /* Tablet and up */
      .header {
        padding: 25px 30px;
        font-size: 38px;
      }
      .hamburger {
        top: 30px;
        right: 30px;
        width: 42px;
        height: 36px;
      }
      .hamburger span {
        height: 5px;
      }
      .sidebar {
        width: 350px;
        padding: 100px 40px 40px;
      }
      .sidebar .close-btn {
        top: 40px;
        left: 40px;
        font-size: 50px;
        width: 55px;
        height: 55px;
      }
      .sidebar ul li a {
        font-size: 24px;
        padding: 18px 30px;
      }
      .sidebar ul li a.telegram::before,
      .sidebar ul li a.contact::before,
      .sidebar ul li a.latest-series::before,
      .sidebar ul li a.most-viewed::before,
      .sidebar ul li a.top-rated::before,
      .sidebar ul li a.theme-selector::before,
      .sidebar ul li a.remove-ads::before {
        width: 32px;
        height: 32px;
      }
      .sidebar-logo {
        max-width: 280px;
      }
      .search-container {
        margin: 50px auto 0;
      }
      .search-box {
        padding: 20px 30px;
        font-size: 22px;
      }
      .series-container {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 40px;
        padding: 0 30px;
      }
      .series-card {
        border-radius: 25px;
      }
      .series-card img {
        height: 280px;
        border-radius: 22px 22px 0 0;
      }
      .series-card-title {
        padding: 18px 15px;
        font-size: 20px;
      }
      .stats-section {
          padding: 12px 18px;
          font-size: 16px;
          height: 75px;
      }
      .stat-item svg {
          width: 25px;
          height: 25px;
      }
      .stat-item .count {
          font-size: 18px;
      }
      .stat-item .label {
          font-size: 14px;
      }
      .episodes {
        padding: 25px;
        border-radius: 0 0 25px 25px;
      }
      .episodes a {
        padding: 18px 25px;
        font-size: 20px;
        border-radius: 12px;
      }
      .episodes a::before {
        width: 32px;
        height: 32px;
      }
    }

    @media (min-width: 1200px) { /* Large Desktops */
        .series-container {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }
    }
  ]]></b:skin>
</head>
<body class="fire-theme"> 
  <div id="loader">
    <div class="spinner"></div>
    <p>جاري تحميل المسلسلات... استعد للمتعة!</p>
  </div>

  <div class="hamburger" id="hamburgerBtn" aria-label="فتح القائمة الجانبية" role="button" tabindex="0">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <nav class="sidebar" id="sidebar" aria-label="القائمة الجانبية">
    <img src="https://l.top4top.io/p_3472qtqft0.png" alt="لوغو حكايتنا - مسلسلات تركية" class="sidebar-logo" />
    <span class="close-btn" id="closeSidebar" role="button" tabindex="0" aria-label="إغلاق القائمة">&#215;</span>
    <ul>
      <li><a href="javascript:void(0);" id="latestSeriesLink" class="latest-series">آخر المسلسلات</a></li>
      <li><a href="javascript:void(0);" id="mostViewedLink" class="most-viewed">الأكثر مشاهدة</a></li>
      <li><a href="javascript:void(0);" id="topRatedLink" class="top-rated">الأعلى تقييمًا</a></li>
      <li><a href="javascript:void(0);" id="themeSelectorLink" class="theme-selector">اختيار الثيم</a></li>
      <div class="theme-picker" id="themePicker">
          <h4>اختر ثيمًا:</h4>
          <div class="theme-options">
              <div class="theme-option theme-fire" data-theme="fire-theme">
                  <div class="color-box"></div>
                  <span class="theme-name">الناري</span>
              </div>
              <div class="theme-option theme-blue" data-theme="blue-theme">
                  <div class="color-box"></div>
                  <span class="theme-name">الأزرق البارد</span>
              </div>
              <div class="theme-option theme-green" data-theme="green-theme">
                  <div class="color-box"></div>
                  <span class="theme-name">الغامق الأخضر</span>
              </div>
          </div>
      </div>
      <li><a href="javascript:void(0);" id="removeAdsLink" class="remove-ads">هل تريد إزالة الإعلانات؟</a></li>
      <li><a href="https://t.me/a_sq9" target="_blank" rel="noopener noreferrer" class="telegram">قناة تلجرام</a></li>
      <li><a href="https://t.me/loguxj" target="_blank" rel="noopener noreferrer" class="contact">تواصل معنا</a></li>
    </ul>
    <div class="sidebar-footer">
        © <span id="currentYear"></span> حكايتنا. جميع الحقوق محفوظة.
    </div>
  </nav>

  <div class="overlay" id="overlay"></div>

  <div class="content-wrapper" id="contentWrapper">
    <h1 class="header">حكايتنا • مسلسلات تركية</h1>
    <div class="search-container">
      <input
        type="text"
        id="searchInput"
        class="search-box"
        placeholder="ابحث عن مسلسل..."
        autocomplete="off"
        aria-label="ابحث عن مسلسل"
      />
    </div>
    
    <div class="ads-box" id="adBox1" aria-label="إعلانات الموقع">
      <p style="color:var(--text-muted); font-size:14px; margin-bottom: 5px;">مساحة إعلانية</p>
      <script type="text/javascript">
        atOptions = {
          'key' : '6afdb390833de871fae19db104b9783d',
          'format' : 'iframe',
          'height' : 250,
          'width' : 300,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/6afdb390833de871fae19db104b9783d/invoke.js"></script>
    </div>

    <h2 style="color:var(--text-light); text-align:center; margin-top:40px; margin-bottom:20px; font-size:28px; text-shadow: 0 0 10px rgba(255,255,255,0.5);">أحدث المسلسلات التركية</h2>
    <div class="series-container" id="seriesContainer">
      </div>

    <div class="ads-box" id="adBox2" aria-label="إعلانات الموقع">
      <p style="color:var(--text-muted); font-size:14px; margin-bottom: 5px;">مساحة إعلانية</p>
      <script type="text/javascript">
        atOptions = {
          'key' : 'fa91666bd323d4f800c7e90787b7a858',
          'format' : 'iframe',
          'height' : 300,
          'width' : 160,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/fa91666bd323d4f800c7e90787b7a858/invoke.js"></script>
    </div>

    <div class="ads-box" id="adBox3" aria-label="إعلانات الموقع">
      <p style="color:var(--text-muted); font-size:14px; margin-bottom: 5px;">مساحة إعلانية</p>
      <script type="text/javascript">
        atOptions = {
          'key' : '36dbf13da4ae100c4f10bdcf2070f943',
          'format' : 'iframe',
          'height' : 50,
          'width' : 320,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/36dbf13da4ae100c4f10bdcf2070f943/invoke.js"></script>
    </div>

  </div>

  <div class="video-player-overlay" id="videoPlayerOverlay">
      <div class="video-player-container">
          <span class="video-player-close" id="videoPlayerClose">&#215;</span>
          <iframe id="videoPlayerIframe" class="video-player-iframe" allowfullscreen="true" frameborder="0" scrolling="no" referrerpolicy="no-referrer"></iframe>
      </div>
  </div>

<script type="module">
  //<![CDATA[
    // استيراد الدوال المطلوبة من Firebase SDK v11
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getDatabase, ref, get, runTransaction, set } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    // بيانات تهيئة Firebase الخاصة بك (يرجى التأكد من أنها صحيحة)
    const firebaseConfig = {
      apiKey: "AIzaSyCEaxXR5eqzg0e5JvjWAFjZ5ZeMraMYREn",
      authDomain: "mo-play-b0cb7.firebaseapp.com",
      databaseURL: "https://mo-play-b0cb7-default-rtdb.firebaseio.com",
      projectId: "mo-play-b0cb7",
      storageBucket: "mo-play-b0cb7.firebasestorage.app",
      messagingSenderId: "575424024738",
      appId: "1:575424024738:web:0b1736c0c2e496adf607fb",
      measurementId: "G-33QRGFTW30"
    };

    // تهيئة Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // المرجع الرئيسي لبيانات المسلسلات في Firebase
    const seriesRef = ref(db, 'series');
    // مرجع لنقاط المستخدمين
    const usersPointsRef = ref(db, 'users');

    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sidebar = document.getElementById('sidebar');
    const closeSidebarBtn = document.getElementById('closeSidebar');
    const contentWrapper = document.getElementById('contentWrapper');
    const loader = document.getElementById('loader');
    const overlay = document.getElementById('overlay');
    const searchInput = document.getElementById('searchInput');
    
    // عناصر القائمة الجانبية
    const latestSeriesLink = document.getElementById('latestSeriesLink');
    const mostViewedLink = document.getElementById('mostViewedLink');
    const topRatedLink = document.getElementById('topRatedLink');
    const themeSelectorLink = document.getElementById('themeSelectorLink'); // زر اختيار الثيمات
    const themePicker = document.getElementById('themePicker');             // حاوية الثيمات
    const themeOptions = document.querySelectorAll('.theme-option');     // خيارات الثيمات الفردية

    // عناصر مشغل الفيديو
    const videoPlayerOverlay = document.getElementById('videoPlayerOverlay');
    const videoPlayerIframe = document.getElementById('videoPlayerIframe');
    const videoPlayerClose = document.getElementById('videoPlayerClose');

    // عناصر نظام النقاط
    const removeAdsLink = document.getElementById('removeAdsLink'); // الرابط في القائمة الجانبية
    let pointsSystemContainer = null; // سيتم إنشاؤه ديناميكياً

    const ADS_TARGET_POINTS = 15; // عدد النقاط المطلوب لإخفاء الإعلانات

    let allSeriesData = []; // سيتم تخزين البيانات هنا بعد الفرز الأولي
    let currentOpenEpisodes = null;
    let currentUserId = null; // معرف المستخدم الحالي
    let currentUserPoints = 0; // نقاط المستخدم الحالي

    // دالة لإنشاء معرف فريد للمستخدم (إذا لم يكن موجوداً)
    function getOrCreateUserId() {
        let userId = localStorage.getItem('user_id');
        if (!userId) {
            // إنشاء معرف فريد بسيط (يمكن استبداله بـ UUID أكثر قوة إذا أردت)
            userId = 'user_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            localStorage.setItem('user_id', userId);
        }
        return userId;
    }

    // دالة لفتح وإغلاق القائمة الجانبية
    function toggleSidebar() {
      hamburgerBtn.classList.toggle('open');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
      contentWrapper.classList.toggle('blurred');
      if (!sidebar.classList.contains('open')) {
          // تأكد من إزالة blur عند إغلاق القائمة
          contentWrapper.classList.remove('blurred');
          // إخفاء قائمة الثيمات ونظام النقاط عند إغلاق السايد بار بالكامل
          themePicker.classList.remove('active');
          if (pointsSystemContainer) {
              pointsSystemContainer.remove(); // إزالة الحاوية عند إغلاق السايدبار
              pointsSystemContainer = null; // إعادة تعيين المتغير
          }
      }
    }

    // فتح القائمة الجانبية عند الضغط على زر الهامبرجر
    hamburgerBtn.addEventListener('click', toggleSidebar);

    // إغلاق القائمة الجانبية عند الضغط على زر الإغلاق (X)
    closeSidebarBtn.addEventListener('click', toggleSidebar);

    // إغلاق القائمة الجانبية عند الضغط على الـ overlay
    overlay.addEventListener('click', toggleSidebar);

    // إغلاق القائمة الجانبية عند الضغط على زر Escape
    document.addEventListener('keydown', e => {
      if (e.key === "Escape" && sidebar.classList.contains('open')) {
        toggleSidebar();
      }
    });

    // دالة لتنظيف النص للاستخدام كمفتاح في Firebase وللبحث
    function normalizeTitleForFirebase(title) {
      return title.replace(/^(مسلسل|مسلسلات)\s*/, '')
                  .replace(/[^a-zA-Z0-9\u0600-\u06FF]+/g, '_')
                  .replace(/_+/g, '_')
                  .replace(/^_|_$/g, '')
                  .trim()
                  .toLowerCase();
    }

    // دالة لتنسيق عدد المشاهدات بشكل احترافي (الآلاف والمليارات)
    function formatCount(count) {
        if (count < 1000) {
            return count.toString();
        } else if (count < 1000000) {
            return `${(count / 1000).toFixed(1).replace(/\.0$/, '')}K`; // أضف 'K' للآلاف
        } else {
            return `${(count / 1000000).toFixed(1).replace(/\.0$/, '')}M`; // أضف 'M' للملايين
        }
    }

    // دالة لتجهيز المسلسلات للفرز والعرض الأولي
    function prepareSeriesData(seriesObjectsFromFirebase) {
      const likedSeriesIds = JSON.parse(localStorage.getItem('liked_series_ids') || '[]');
      const seriesArray = Object.keys(seriesObjectsFromFirebase).map(key => {
        const series = seriesObjectsFromFirebase[key];
        const likes = series.likes || 0;
        const views = series.views || 0;
        const episodes = series.episodes || [];
        const category = series.category || 'عام'; // التصنيف الجديد

        // حساب آخر تاريخ تحديث للحلقات
        let latestEpisodeDate = 0;
        episodes.forEach(ep => {
            if (ep.updatedAt) { // افترض أن لديك حقل 'updatedAt' في Firebase للحلقة
                const date = new Date(ep.updatedAt);
                if (date.getTime() > latestEpisodeDate) {
                    latestEpisodeDate = date.getTime();
                }
            }
        });
        
        return {
          ...series,
          safeTitle: key, // هذا هو المفتاح الفريد للمسلسل في Firebase
          normalizedTitle: normalizeTitleForFirebase(series.title),
          likes: likes,
          views: views,
          episodes: episodes,
          likedByUser: likedSeriesIds.includes(key),
          lastUpdated: latestEpisodeDate, // إضافة تاريخ آخر تحديث للمسلسل
          category: category // إضافة التصنيف للبيانات
        };
      });

      // الفرز الافتراضي: حسب اللايكات (الأعلى)، ثم حسب المشاهدات (الأعلى)
      seriesArray.sort((a, b) => {
        if (b.likes !== a.likes) {
            return b.likes - a.likes;
        }
        return b.views - a.views;
      });
      return seriesArray;
    }

    // دالة لعرض المسلسلات في الواجهة
    function renderSeries(seriesToRender) {
      const container = document.getElementById('seriesContainer');
      container.innerHTML = ''; // مسح المحتوى الحالي بالكامل لإعادة رسمه

      if (seriesToRender.length === 0) {
        container.innerHTML = '<p style="color:var(--text-muted); text-align:center; font-size:20px; padding:50px;">لا توجد مسلسلات مطابقة للبحث.</p>';
        return;
      }

      seriesToRender.forEach((series, index) => {
        const card = document.createElement('div');
        card.className = 'series-card';
        card.setAttribute('data-series-id', series.safeTitle); // استخدام data-series-id
        card.setAttribute('data-series-index', index);
        card.style.transitionDelay = `${index * 0.05}s`;

        // تحقق مما إذا كانت هناك أي حلقة جديدة في هذا المسلسل
        const hasNewEpisode = series.episodes.some(ep => ep.isNew === true);
        const newEpisodeIndicator = hasNewEpisode ? `<div class="new-episode-indicator">حلقة جديدة!</div>` : '';

        // عرض التصنيف
        const categoryBadge = series.category ? `<div class="category-badge">${series.category}</div>` : '';

        // تعديل هنا: روابط الحلقات لن تستخدم target="_blank"
        const episodesHtml = (series.episodes && Array.isArray(series.episodes) && series.episodes.length > 0)
          ? series.episodes.map((ep, i) => {
                const linkClass = `episode-link-initial ${ep.isNew ? 'new-episode-link' : ''}`;
                const linkStyle = `transition-delay: ${i * 0.05}s;`;
                // إضافة data-video-url للحلقة
                return `<a href="javascript:void(0);" data-video-url="${encodeURI(ep.link || '')}" aria-label="رابط الحلقة ${ep.title}" class="${linkClass}" style="${linkStyle}">${ep.title}</a>`;
            }).join('')
          : '<p style="text-align:center;color:var(--text-muted);font-size:16px;padding:20px;">لا توجد حلقات متاحة حالياً. تابعونا!</p>';

        const escapedSeriesImage = series.image ? series.image.replace(/&/g, '&amp;') : '';

        card.innerHTML = `
          ${newEpisodeIndicator}
          ${categoryBadge} <img src="${escapedSeriesImage}" alt="${series.title} - بوستر المسلسل" />
          <div class="series-card-title">${series.title}</div>
          <div class="stats-section">
            <div class="stat-item views-item">
                <div class="icon-and-count">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                        <path d="M480-320q-75 0-127.5-52.5T300-500q0-75 52.5-127.5T480-680q75 0 127.5 52.5T660-500q0 75-52.5 127.5T480-320Zm0-80q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29Zm0 317Q220-213 110-348.5T0-500q0-151 110-286.5T480-787q260 0 370 135.5T960-500q0 151-110 286.5T480-213Zm0-290Zm0 210q174 0 297-106.5T860-500q-123-103-297-210T100-500q123 103 297 210Z"/>
                    </svg>
                    <span class="count views-count">${formatCount(series.views)}</span>
                </div>
                <span class="label">مشاهدة</span>
            </div>
            <div class="stat-item like-button ${series.likedByUser ? 'liked' : ''}" role="button" aria-label="أعجبني هذا المسلسل">
                <div class="icon-and-count">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                        <path d="M720-120H240q-33 0-56.5-23.5T160-200v-360q0-33 23.5-56.5T240-640h280l-50-200q-5-19 2.5-35T510-920q10-5 21-2.5t19 12.5l230 230q10 10 15 22.5t5 26.5v80q0 17-6.5 31.5T774-400H640q-17 0-28.5 11.5T600-360v200q0 17 11.5 28.5T640-120h80ZM240-200h480v-160H240v160Zm0-360h360l50 200H240v-200Z"/>
                    </svg>
                    <span class="count likes-count">${series.likes}</span>
                </div>
                <span class="label">لايك</span>
            </div>
          </div>
          <div class="episodes">${episodesHtml}</div>
        `;
        container.appendChild(card);
      });
      // بعد إضافة البطاقات، قم بإعداد مستمعي الأحداث
      setupEventListenersOnSeriesCards();
    }

    // دالة جديدة لربط مستمعي الأحداث ببطاقات المسلسلات
    function setupEventListenersOnSeriesCards() {
        // إضافة وظيفة الإعجاب/إزالة الإعجاب لكل زر
        document.querySelectorAll('.like-button').forEach(button => {
            // قم بإزالة أي مستمعات أحداث سابقة لتجنب التكرار
            button.removeEventListener('click', handleLikeButtonClick); // تأكد من إزالة المستمعات القديمة
            button.addEventListener('click', handleLikeButtonClick);
        });

        // فتح وغلق قائمة الحلقات عند الضغط على كل بطاقة مسلسل
        document.querySelectorAll('.series-card').forEach(card => {
            // قم بإزالة أي مستمعات أحداث سابقة لتجنب التكرار
            card.removeEventListener('click', handleSeriesCardClick); // تأكد من إزالة المستمعات القديمة
            card.addEventListener('click', handleSeriesCardClick);
        });

        // إضافة مستمعات للأحداث لروابط الحلقات داخل كل بطاقة
        document.querySelectorAll('.episodes a').forEach(link => {
            link.removeEventListener('click', handleEpisodeLinkClick); // تجنب التكرار
            link.addEventListener('click', handleEpisodeLinkClick);
        });
    }

    // دالة منفصلة لمعالجة حدث اللايك
    async function handleLikeButtonClick(event) {
        event.stopPropagation(); // منع انتشار الحدث لكي لا يفتح قائمة الحلقات

        const button = event.currentTarget;
        const card = button.closest('.series-card');
        const seriesId = card.getAttribute('data-series-id');
        const likesCountSpan = button.querySelector('.likes-count');

        let likedSeriesIds = JSON.parse(localStorage.getItem('liked_series_ids') || '[]');
        const isLiked = likedSeriesIds.includes(seriesId);

        const likesNodeRef = ref(db, `series/${seriesId}/likes`);

        try {
            const result = await runTransaction(likesNodeRef, (currentLikes) => {
                currentLikes = currentLikes || 0;
                if (isLiked) {
                    return currentLikes - 1;
                } else {
                    return currentLikes + 1;
                }
            });

            if (result.committed) {
                // تحديث حالة localStorage
                if (isLiked) {
                    likedSeriesIds = likedSeriesIds.filter(id => id !== seriesId);
                    button.classList.remove('liked');
                    button.setAttribute('aria-label', 'أعجبني هذا المسلسل'); // تغيير النص بعد الإعجاب
                } else {
                    likedSeriesIds.push(seriesId);
                    button.classList.add('liked');
                    button.setAttribute('aria-label', 'إزالة الإعجاب عن هذا المسلسل'); // تغيير النص بعد الإعجاب
                }
                localStorage.setItem('liked_series_ids', JSON.stringify(likedSeriesIds));
                
                // تحديث الواجهة للمسلسل الحالي فقط
                if (likesCountSpan && result.snapshot.val() !== null) {
                    likesCountSpan.textContent = formatCount(result.snapshot.val());
                }

                // تحديث البيانات في allSeriesData (مهم للبحث والفرز)
                const seriesToUpdate = allSeriesData.find(s => s.safeTitle === seriesId);
                if (seriesToUpdate) {
                    seriesToUpdate.likes = result.snapshot.val();
                    seriesToUpdate.likedByUser = !isLiked;
                }
            } else {
                console.log("Firebase transaction not committed for likes.");
            }
        } catch (error) {
            console.error("Firebase like transaction failed: ", error);
            alert('حدث خطأ أثناء تحديث اللايك. يرجى المحاولة مرة أخرى.');
        }
    }

    // دالة منفصلة لمعالجة حدث النقر على البطاقة
    async function handleSeriesCardClick(e) {
        const card = e.currentTarget;
        // التأكد أن النقر ليس على زر الإعجاب أو رابط الحلقة أو أي عنصر داخل زر الإعجاب
        if (e.target.closest('.like-button') || e.target.tagName.toLowerCase() === 'a') {
            return;
        }

        const episodes = card.querySelector('.episodes');
        const seriesId = card.getAttribute('data-series-id');
        
        // إذا كانت نفس الحلقات مفتوحة، أغلقها
        if (currentOpenEpisodes && currentOpenEpisodes === episodes) {
            episodes.classList.remove('show');
            currentOpenEpisodes = null;
            // إزالة تأثير الظهور من الروابط عند الإغلاق
            episodes.querySelectorAll('.episode-link-initial').forEach(link => {
                link.classList.remove('episode-link-fade-in');
            });
            return;
        }

        // إغلاق أي حلقات أخرى مفتوحة
        if (currentOpenEpisodes) {
            currentOpenEpisodes.classList.remove('show');
            // إزالة تأثير الظهور من الروابط عند إغلاق الحلقات الأخرى
            currentOpenEpisodes.querySelectorAll('.episode-link-initial').forEach(link => {
                link.classList.remove('episode-link-fade-in');
            });
        }
        
        // فتح الحلقات الجديدة
        episodes.classList.add('show');
        currentOpenEpisodes = episodes;

        // ************ التعديل لزيادة المشاهدات مرة واحدة لكل مستخدم ************
        const viewedSeries = JSON.parse(localStorage.getItem('viewed_series') || '[]');
        if (!viewedSeries.includes(seriesId)) {
            const viewsNodeRef = ref(db, `series/${seriesId}/views`);
            try {
                const result = await runTransaction(viewsNodeRef, (currentViews) => {
                    return (currentViews || 0) + 1;
                });

                if (result.committed) {
                    // تحديث العداد في الواجهة مباشرة بعد التحديث في Firebase
                    const viewsCountSpan = card.querySelector('.views-item .count');
                    if (viewsCountSpan && result.snapshot.val() !== null) {
                        viewsCountSpan.textContent = formatCount(result.snapshot.val());
                    }
                    viewedSeries.push(seriesId);
                    localStorage.setItem('viewed_series', JSON.stringify(viewedSeries));

                    // تحديث البيانات في allSeriesData (مهم للبحث والفرز)
                    const seriesToUpdate = allSeriesData.find(s => s.safeTitle === seriesId);
                    if (seriesToUpdate) {
                        seriesToUpdate.views = result.snapshot.val();
                    }
                } else {
                    console.log("View count transaction not committed.");
                }
            } catch (error) {
                console.error("Firebase view transaction failed: ", error);
                alert('حدث خطأ أثناء تحديث المشاهدة. يرجى المحاولة مرة أخرى.');
            }
        } else {
            console.log(`Series ${seriesId} already viewed by this user. Not incrementing view count.`);
        }
        // ************ نهاية التعديل ************

        // حساب وتحديد الـ 'top' لضمان الظهور أسفل الصورة بالضبط
        const img = card.querySelector('img');
        const title = card.querySelector('.series-card-title');
        const statsSection = card.querySelector('.stats-section');
        
        // استخدام boundingClientRect لحساب الارتفاعات بدقة أكبر
        const imgRect = img ? img.getBoundingClientRect() : {height: 0};
        const titleRect = title ? title.getBoundingClientRect() : {height: 0};
        const statsRect = statsSection ? statsSection.getBoundingClientRect() : {height: 0};
        
        // الموضع العلوي للحلقات يجب أن يكون مجموع ارتفاع الصورة والعنوان وقسم الإحصائيات
        episodes.style.top = `${imgRect.height + titleRect.height + statsRect.height}px`;


        // إضافة تأثير ظهور للحلقات بعد فتحها
        setTimeout(() => {
            episodes.querySelectorAll('.episode-link-initial').forEach((link, i) => {
                link.style.transitionDelay = `${i * 0.05}s`;
                link.classList.add('episode-link-fade-in');
            });
        }, 100);

        // جعل البطاقة المفتوحة تظهر في منتصف الشاشة (اختياري، لإحساس أفضل بالاستخدام)
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // دالة لمعالجة النقر على رابط الحلقة
    function handleEpisodeLinkClick(event) {
        event.preventDefault(); // منع السلوك الافتراضي للرابط (فتح في صفحة جديدة)
        const videoUrl = event.currentTarget.getAttribute('data-video-url');

        if (videoUrl && videoUrl !== 'null' && videoUrl !== 'undefined') {
            let embedUrl = videoUrl;
            // التحقق إذا كان الرابط يوتيوب وتحويله إلى رابط تضمين
            if (videoUrl.includes("youtube.com/watch?v=")) {
                const videoId = videoUrl.split("v=")[1].split("&")[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            } else if (videoUrl.includes("youtu.be/")) {
                const videoId = videoUrl.split("youtu.be/")[1].split("?")[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            }
            // يمكن إضافة شروط أخرى لأنواع مشغلات الفيديو المختلفة هنا

            videoPlayerIframe.src = embedUrl;
            videoPlayerOverlay.classList.add('active');
            // إضافة تأثير التعتيم على المحتوى الرئيسي خلف المشغل
            contentWrapper.classList.add('blurred');
        } else {
            alert('عذرًا، رابط هذه الحلقة غير متاح حاليًا.');
        }
    }

    // إغلاق مشغل الفيديو
    videoPlayerClose.addEventListener('click', () => {
        videoPlayerOverlay.classList.remove('active');
        videoPlayerIframe.src = ''; // إيقاف تشغيل الفيديو
        // إزالة تأثير التعتيم عن المحتوى الرئيسي
        contentWrapper.classList.remove('blurred');
    });

    // إغلاق مشغل الفيديو عند النقر على الـ overlay الخاص به
    videoPlayerOverlay.addEventListener('click', (event) => {
        if (event.target === videoPlayerOverlay) { // تأكد أن النقر كان على الـ overlay نفسه وليس داخل المشغل
            videoPlayerOverlay.classList.remove('active');
            videoPlayerIframe.src = ''; // إيقاف تشغيل الفيديو
            contentWrapper.classList.remove('blurred');
        }
    });

    // إغلاق مشغل الفيديو عند الضغط على زر Escape
    document.addEventListener('keydown', e => {
      if (e.key === "Escape" && videoPlayerOverlay.classList.contains('active')) {
        videoPlayerOverlay.classList.remove('active');
        videoPlayerIframe.src = ''; // إيقاف تشغيل الفيديو
        contentWrapper.classList.remove('blurred');
      }
    });


    // دالة لتطبيق تأثير الظهور التدريجي على البطاقات
    function observeElements() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

        document.querySelectorAll('.series-card').forEach(card => {
            observer.observe(card);
        });
    }

    // بحث مباشر داخل المسلسلات
    function setupSearch() {
      searchInput.addEventListener('input', () => {
        const filterTerm = normalizeTitleForFirebase(searchInput.value);

        const filteredSeries = allSeriesData.filter(series => {
            return series.normalizedTitle.includes(filterTerm);
        });
        renderSeries(filteredSeries); // إعادة عرض المسلسلات المفلترة
        setTimeout(observeElements, 100);
      });
    }

    // دالة لعرض آخر المسلسلات
    latestSeriesLink.addEventListener('click', () => {
        toggleSidebar(); // إغلاق القائمة الجانبية بعد النقر
        themePicker.classList.remove('active'); // إخفاء قائمة الثيمات
        if (pointsSystemContainer) { pointsSystemContainer.remove(); pointsSystemContainer = null; }
        // فرز المسلسلات حسب تاريخ آخر تحديث للحلقات (الأحدث أولاً)
        const sortedByLatest = [...allSeriesData].sort((a, b) => b.lastUpdated - a.lastUpdated);
        renderSeries(sortedByLatest);
        searchInput.value = ''; // مسح حقل البحث
        setTimeout(observeElements, 100);
    });

    // دالة لعرض المسلسلات الأكثر مشاهدة
    mostViewedLink.addEventListener('click', () => {
        toggleSidebar();
        themePicker.classList.remove('active'); // إخفاء قائمة الثيمات
        if (pointsSystemContainer) { pointsSystemContainer.remove(); pointsSystemContainer = null; }
        // فرز المسلسلات حسب عدد المشاهدات (الأعلى أولاً)
        const sortedByViews = [...allSeriesData].sort((a, b) => b.views - a.views);
        renderSeries(sortedByViews);
        searchInput.value = '';
        setTimeout(observeElements, 100);
    });

    // دالة لعرض المسلسلات الأعلى تقييمًا (اللايكات)
    topRatedLink.addEventListener('click', () => {
        toggleSidebar();
        themePicker.classList.remove('active'); // إخفاء قائمة الثيمات
        if (pointsSystemContainer) { pointsSystemContainer.remove(); pointsSystemContainer = null; }
        // فرز المسلسلات حسب عدد اللايكات (الأعلى أولاً)
        const sortedByLikes = [...allSeriesData].sort((a, b) => b.likes - a.likes);
        renderSeries(sortedByLikes);
        searchInput.value = '';
        setTimeout(observeElements, 100);
    });
    
    // ****** وظائف الثيمات الجديدة ******
    const themes = ['fire-theme', 'blue-theme', 'green-theme'];

    function applyTheme(themeName) {
        document.body.classList.remove(...themes); // إزالة كل الثيمات الموجودة
        document.body.classList.add(themeName); // إضافة الثيم الجديد
        localStorage.setItem('selectedTheme', themeName); // حفظ اختيار المستخدم

        // تحديث حالة الثيم النشط في الواجهة
        themeOptions.forEach(option => {
            if (option.getAttribute('data-theme') === themeName) {
                option.classList.add('active-theme');
            } else {
                option.classList.remove('active-theme');
            }
        });
    }

    // عند النقر على "اختيار الثيم" في القائمة الجانبية
    themeSelectorLink.addEventListener('click', (e) => {
        e.preventDefault(); // منع أي سلوك افتراضي للرابط
        themePicker.classList.toggle('active'); // تبديل إظهار/إخفاء قائمة الثيمات
        if (pointsSystemContainer) { pointsSystemContainer.remove(); pointsSystemContainer = null; } // إخفاء نظام النقاط
    });

    // عند النقر على أحد خيارات الثيمات
    themeOptions.forEach(option => {
        option.addEventListener('click', () => {
            const selectedTheme = option.getAttribute('data-theme');
            applyTheme(selectedTheme);
            // اختياري: إغلاق قائمة الثيمات بعد الاختيار
            // themePicker.classList.remove('active'); 
            // toggleSidebar(); // أو إغلاق السايدبار بالكامل
        });
    });

    // تحميل الثيم المحفوظ عند بدء تشغيل الموقع
    function loadSavedTheme() {
        const savedTheme = localStorage.getItem('selectedTheme');
        if (savedTheme && themes.includes(savedTheme)) {
            applyTheme(savedTheme);
        } else {
            applyTheme('fire-theme'); // تطبيق الثيم الناري كافتراضي
        }
    }

    // تحديث سنة حقوق النشر تلقائياً
    document.addEventListener('DOMContentLoaded', () => {
        const currentYearSpan = document.getElementById('currentYear');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }
    });

    // ************ نظام النقاط وإخفاء الإعلانات - بداية الكود الجديد ************

    // دالة لجلب نقاط المستخدم من Firebase
    async function getUserPoints(userId) {
        try {
            const snapshot = await get(ref(db, `users/${userId}/points`));
            return snapshot.val() || 0;
        } catch (error) {
            console.error("Error fetching user points:", error);
            return 0;
        }
    }

    // دالة لتحديث نقاط المستخدم في Firebase
    async function updatePoints(userId, points) {
        try {
            await set(ref(db, `users/${userId}/points`), points);
            console.log(`Points for ${userId} updated to ${points}`);
        } catch (error) {
            console.error("Error updating user points:", error);
        }
    }

    // دالة لزيادة نقاط المحيل
    async function incrementReferrerPoints(referrerId, visitorId) {
        // منع تكرار النقاط من نفس الزائر لنفس المحيل
        let creditedReferrers = JSON.parse(localStorage.getItem('credited_referrers') || '{}');
        if (creditedReferrers[referrerId] && creditedReferrers[referrerId].includes(visitorId)) {
            console.log(`Visitor ${visitorId} already credited referrer ${referrerId}. Skipping point increment.`);
            return;
        }

        const referrerPointsRef = ref(db, `users/${referrerId}/points`);
        try {
            const result = await runTransaction(referrerPointsRef, (currentPoints) => {
                return (currentPoints || 0) + 1;
            });

            if (result.committed) {
                console.log(`Point incremented for referrer ${referrerId}. New points: ${result.snapshot.val()}`);
                // تحديث localStorage للزائر لمنع تكرار النقطة
                if (!creditedReferrers[referrerId]) {
                    creditedReferrers[referrerId] = [];
                }
                creditedReferrers[referrerId].push(visitorId);
                localStorage.setItem('credited_referrers', JSON.stringify(creditedReferrers));
            } else {
                console.log("Referrer point transaction not committed.");
            }
        } catch (error) {
            console.error("Error incrementing referrer points:", error);
        }
    }

    // دالة لإخفاء الإعلانات
    function hideAds() {
        const adBoxes = document.querySelectorAll('.ads-box');
        adBoxes.forEach(box => {
            box.classList.add('hidden');
        });
        localStorage.setItem('ads_hidden', 'true'); // حفظ حالة إخفاء الإعلانات
        console.log('Ads are now hidden.');
    }

    // دالة لإظهار الإعلانات
    function showAds() {
        const adBoxes = document.querySelectorAll('.ads-box');
        adBoxes.forEach(box => {
            box.classList.remove('hidden');
        });
        localStorage.removeItem('ads_hidden'); // إزالة حالة إخفاء الإعلانات
        console.log('Ads are now visible.');
    }

    // دالة لإنشاء وعرض حاوية نظام النقاط في السايدبار
    async function renderPointsSystem() {
        // إزالة أي حاوية موجودة مسبقاً
        if (pointsSystemContainer) {
            pointsSystemContainer.remove();
            pointsSystemContainer = null;
        }

        // إنشاء الحاوية
        pointsSystemContainer = document.createElement('div');
        pointsSystemContainer.className = 'points-system-container';
        
        // جلب نقاط المستخدم الحالية
        currentUserPoints = await getUserPoints(currentUserId);
        const adsHiddenStatus = localStorage.getItem('ads_hidden') === 'true';

        // بناء محتوى الحاوية
        pointsSystemContainer.innerHTML = `
            <h4>نظام إزالة الإعلانات</h4>
            <p class="points-info">نقاطك الحالية: <span id="currentPoints">${currentUserPoints}</span> / ${ADS_TARGET_POINTS}</p>
            <div class="share-link-section">
                <p style="color:var(--text-muted); font-size:14px; margin-bottom: 5px;">شارك هذا الرابط لجمع النقاط:</p>
                <input type="text" id="shareLinkInput" class="share-link-input" value="" readonly />
                <button id="copyShareLinkBtn" class="copy-link-btn">نسخ الرابط</button>
            </div>
            <button id="toggleAdsBtn" class="hide-ads-btn" ${currentUserPoints < ADS_TARGET_POINTS ? 'disabled' : ''}>
                ${adsHiddenStatus ? 'إظهار الإعلانات' : 'إخفاء الإعلانات'}
            </button>
            <p style="color:var(--text-muted); font-size:12px; margin-top: 10px;">
                (تذكر: النقطة تُحسب فقط عندما يزور شخص آخر الموقع من خلال رابطك.)
            </p>
        `;
        
        // إضافة الحاوية بعد روابط القائمة الجانبية وقبل حقوق النشر
        const sidebarUl = sidebar.querySelector('ul');
        sidebar.insertBefore(pointsSystemContainer, sidebarUl.nextSibling); // أضف بعد الـ ul

        // تحديث رابط المشاركة
        const shareLinkInput = document.getElementById('shareLinkInput');
        const currentUrl = window.location.origin + window.location.pathname;
        shareLinkInput.value = `${currentUrl}?ref=${currentUserId}`;

        // إضافة مستمعي الأحداث للأزرار الجديدة
        document.getElementById('copyShareLinkBtn').addEventListener('click', () => {
            shareLinkInput.select();
            document.execCommand('copy');
            alert('تم نسخ الرابط بنجاح!');
        });

        document.getElementById('toggleAdsBtn').addEventListener('click', () => {
            if (currentUserPoints >= ADS_TARGET_POINTS) {
                if (localStorage.getItem('ads_hidden') === 'true') {
                    showAds();
                    document.getElementById('toggleAdsBtn').textContent = 'إخفاء الإعلانات';
                } else {
                    hideAds();
                    document.getElementById('toggleAdsBtn').textContent = 'إظهار الإعلانات';
                }
            } else {
                alert(`تحتاج إلى ${ADS_TARGET_POINTS} نقطة لإخفاء الإعلانات. لديك حالياً ${currentUserPoints} نقطة.`);
            }
        });

        // إخفاء قائمة الثيمات عند فتح نظام النقاط
        themePicker.classList.remove('active');
    }

    // عند النقر على "هل تريد إزالة الإعلانات؟" في القائمة الجانبية
    removeAdsLink.addEventListener('click', async (e) => {
        e.preventDefault();
        // إغلاق أي حاوية أخرى (مثل الثيمات)
        themePicker.classList.remove('active');
        // تبديل إظهار/إخفاء حاوية نظام النقاط
        if (pointsSystemContainer && pointsSystemContainer.parentNode) {
            pointsSystemContainer.remove();
            pointsSystemContainer = null;
        } else {
            await renderPointsSystem(); // إعادة إنشاء وعرض الحاوية
        }
    });

    // ************ نظام النقاط وإخفاء الإعلانات - نهاية الكود الجديد ************

    // بدء تحميل الموقع: جلب البيانات من Firebase مباشرة
    window.onload = async () => {
      loader.style.display = 'flex';
      loadSavedTheme(); // تحميل الثيم المحفوظ أولاً
      currentUserId = getOrCreateUserId(); // جلب أو إنشاء معرف المستخدم

      // ************ معالجة روابط الإحالة وزيادة النقاط - بداية ************
      const urlParams = new URLSearchParams(window.location.search);
      const referrerId = urlParams.get('ref');
      if (referrerId && referrerId !== currentUserId) { // تأكد أن المحيل ليس هو نفس المستخدم الحالي
          console.log(`Visited via referrer: ${referrerId}`);
          await incrementReferrerPoints(referrerId, currentUserId);
          // إزالة معامل الإحالة من الـ URL لتجنب تكرار النقاط عند تحديث الصفحة
          const newUrl = window.location.origin + window.location.pathname;
          history.replaceState(null, '', newUrl); // تحديث الـ URL دون إعادة تحميل الصفحة
      }
      // ************ معالجة روابط الإحالة وزيادة النقاط - نهاية ************

      // تحقق من حالة إخفاء الإعلانات عند التحميل
      if (localStorage.getItem('ads_hidden') === 'true') {
          hideAds();
      } else {
          showAds(); // تأكد من إظهارها إذا لم تكن مخفية
      }

      try {
          const snapshot = await get(seriesRef); // استخدم get لجلب البيانات مرة واحدة
          const firebaseRawData = snapshot.val() || {};
          allSeriesData = prepareSeriesData(firebaseRawData); // تجهيز وفرز البيانات الأولية
          renderSeries(allSeriesData); // عرض البيانات لأول مرة
          
          // إخفاء اللودر وتطبيق تأثيرات الظهور
          setTimeout(() => {
              loader.style.opacity = '0';
              loader.style.visibility = 'hidden';
              setTimeout(() => {
                  loader.style.display = 'none';
                  observeElements();
              }, 600); // زيادة الوقت قليلاً ليتناسب مع الانتقالات الجديدة
          }, 500);

      } catch (error) {
          console.error('Firebase read failed:', error);
          // عرض رسالة خطأ واضحة للمستخدم
          document.getElementById('seriesContainer').innerHTML = '<p style="color:var(--primary-color);text-align:center;font-size:24px;font-weight:bold;padding:50px; text-shadow: 0 0 10px var(--glow-primary);">عذرًا، لم نتمكن من تحميل المسلسلات! 🙁<br>يرجى التأكد من اتصالك بالإنترنت وأن بيانات Firebase صحيحة.</p>';
          if (loader.style.display === 'flex') {
              loader.style.opacity = '0';
              loader.style.visibility = 'hidden';
              setTimeout(() => { loader.style.display = 'none'; }, 600);
          }
      }

      setupSearch();
      
      // إضافة مستمع لحدث النقر على body لإغلاق الحلقات وقائمة الثيمات ونظام النقاط عند النقر خارجها
      document.body.addEventListener('click', (event) => {
          // إغلاق الحلقات المفتوحة
          if (currentOpenEpisodes && !event.target.closest('.series-card') && !event.target.closest('.hamburger') && !event.target.closest('.video-player-overlay')) {
              currentOpenEpisodes.classList.remove('show');
              currentOpenEpisodes.querySelectorAll('.episode-link-initial').forEach(link => {
                  link.classList.remove('episode-link-fade-in');
              });
              currentOpenEpisodes = null;
          }
          // إغلاق قائمة الثيمات إذا كانت مفتوحة والنقر ليس عليها أو على زر "اختيار الثيم"
          if (themePicker.classList.contains('active') && !event.target.closest('.theme-picker') && !event.target.closest('#themeSelectorLink')) {
              themePicker.classList.remove('active');
          }
          // إغلاق نظام النقاط إذا كان مفتوحاً والنقر ليس عليه أو على زر "إزالة الإعلانات"
          if (pointsSystemContainer && pointsSystemContainer.parentNode && !event.target.closest('.points-system-container') && !event.target.closest('#removeAdsLink')) {
              pointsSystemContainer.remove();
              pointsSystemContainer = null;
          }
      });
    };

    // كود فتح صفحة إعلان عند الضغط - تم نقله هنا ليكون ضمن نطاق السكريبت الرئيسي
    // هذا الكود يفتح نافذة منبثقة عند أول نقرة على الصفحة.
    // قد يؤثر هذا على تجربة المستخدم وقد تعتبره بعض محركات البحث سلوكاً سلبياً.
    // استخدمه بحذر أو فكر في بدائل أقل تدخلاً.
    document.addEventListener('click', function () {
        window.open('https://www.profitableratecpm.com/d30rgwpfur?key=9aa42ffea671b13e0d3c6f0048490845');
    }, { once: true });
</script>

  //]]>
  </script>

  <b:section id='main' class='main' showaddelement='no'>
    <b:widget id='Blog1' locked='true' title='Main Posts' type='Blog'/>
  </b:section>
<script type='text/javascript' src='//pl27007382.profitableratecpm.com/ce/90/b8/ce90b829b52f59588205502c400d43c7.js'></script>
</body>
</html>
